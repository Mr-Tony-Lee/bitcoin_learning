# 使用 LSTM 循環神經網絡預測股價

## 專案簡介

本專案旨在展示如何使用一種特殊的循環神經網絡（RNN）——長短期記憶網絡（LSTM），來預測微軟（MSFT）的短期股價。整個流程涵蓋了從即時數據獲取、數據預處理、模型建構、訓練、評估到結果視覺化的完整步驟。

這個腳本的核心是將時間序列預測問題轉換為一個監督式學習問題，即利用前一個時間點的股價來預測下一個時間點的股價。

---

## 原理與核心概念

### 1. 時間序列預測 (Time Series Forecasting)
股價本質上是時間序列數據，其數值會隨著時間的推移而變化。我們的目標是根據過去的數據模式來預測未來的數值。

### 2. 長短期記憶網絡 (LSTM)
LSTM 是一種為處理序列數據而設計的神經網絡。與傳統神經網絡不同，LSTM 具有「記憶」能力，可以捕捉到數據中的時間依賴性（例如，股價上漲的趨勢）。這使得它非常適合用於時間序列預測。

### 3. 監督式學習轉換
為了讓神經網絡能夠學習，我們需要將數據轉換為「輸入-輸出」對（X-y）的形式。在這個專案中，我們這樣定義：
-   **輸入 (X)**: 在時間點 `t` 的股價。
-   **輸出 (y)**: 在時間點 `t+1` 的股價。
模型將學習從 X 預測 y 的模式。

### 4. 數據標準化 (Normalization)
在將數據輸入神經網絡之前，通常需要進行標準化。這可以幫助模型的學習過程更快、更穩定。本專案採用了一種簡單的標準化方法：將所有股價數據除以數據集中的第一個股價。

---

## 程式流程詳解

### 1. `get_data()` - 數據獲取與預處理
-   **下載數據**: 使用 `yfinance` 函式庫，下載微軟（MSFT）過去 5 天、每 5 分鐘的股價數據。這是一種高頻率的數據，適合用於短期預測。
-   **數據清洗**: 刪除任何缺失值，並只保留 `Close`（收盤價）這一欄。
-   **標準化**: 複製一份原始收盤價用於最後的繪圖。然後，將所有收盤價除以第一個收盤價，完成標準化。
-   **保存數據**: 將處理後的數據保存為 CSV 檔案，方便檢查與複用。

### 2. `create_dataset()` - 創建輸入-輸出對
這個函數是將時間序列轉換為監督式學習數據集的關鍵。它遍歷股價列表，將每個時間點的價格作為輸入 (X)，並將下一個時間點的價格作為其對應的目標 (y)。

### 3. `split_data()` - 分割訓練與測試集
-   將完整的數據集按照 80/20 的比例分割為訓練集和測試集。
-   接著呼叫 `create_dataset()` 函數，分別為訓練集和測試集創建對應的 (X, y) 數據對。

### 4. `train_rnn()` - 建立與訓練 LSTM 模型
-   **重塑數據 (Reshape)**: LSTM 層要求輸入數據為三維格式：`[樣本數, 時間步, 特徵數]`。由於我們每次只用一個時間點的價格來預測下一個，所以時間步和特徵數都是 1。
-   **建立模型**: 使用 `tf.keras.Sequential` 建立一個簡單的模型，包含：
    -   一個有 50 個神經元的 `LSTM` 層。
    -   一個 `Dense` 層作為輸出層，用於產生最終的預測值。
-   **編譯與訓練**: 使用 `mean_squared_error` 作為損失函數，`adam` 作為優化器來編譯模型。然後，對模型進行 100 個週期的訓練。

### 5. `evaluate_rnn()` - 評估模型
-   使用訓練好的模型對測試集 `X_test` 進行預測。
-   計算預測值與真實值之間的**均方誤差 (Mean Squared Error, MSE)**，這是一個衡量模型預測精度的指標，數值越小代表誤差越小。

### 6. `plot_results()` - 繪製與保存結果
-   **反標準化**: 將模型的標準化預測結果乘以之前保存的 `scaler` 值，還原為真實的股價。
-   **繪圖**: 使用 `matplotlib` 將測試集中的**真實股價**和模型的**預測股價**繪製在同一張圖上。
-   **保存**: 使用 `savefig()` 將生成的圖表保存為 `rnn_prediction.png` 檔案，而不是直接顯示在螢幕上。

### 7. `main()` - 主執行函數
這個函數是整個流程的指揮官，它按照正確的順序呼叫上述所有函數，從數據下載開始，直到最後繪製出結果圖表。

---

## 結果與結論

### 執行結果
-   程式執行後，會在控制台輸出一行 `Mean Squared Error`，提供一個量化的模型誤差評估。
-   同時，在 `data_output` 文件夾中會生成一張名為 `rnn_prediction.png` 的圖片。這張圖會視覺化地展示在測試數據範圍內，模型的預測曲線與真實股價曲線的貼合程度。

### 結論
1.  **模型有效性**: 此專案成功地實現了一個端到端的股價預測流程。從結果圖中可以看出，模型能夠大致跟隨真實股價的短期波動趨勢。這證明了即使是簡單的 LSTM 模型，也能夠從時間序列數據中學習到有用的模式。

2.  **模型局限性**: 由於模型結構非常簡單（只用前一個時間點預測下一個），它本質上是在學習「追隨趨勢」。對於市場的突然轉折或劇烈波動，它的預測能力可能有限。

3.  **應用價值**: 這個專案是學習如何將 RNN/LSTM 應用於時間序列問題的一個絕佳範例。它雖然簡單，但包含了所有必要的步驟。基於這個框架，未來可以進行更複雜的改進，例如：
    -   增加 `look_back` 的天數（用過去多天的數據預測未來）。
    -   加入更多特徵（如成交量、技術指標等）。
    -   嘗試